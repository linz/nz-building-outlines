------------------------------------------------------------------------------
-- Provide unit testing for buildings_lds schema using pgTAP
------------------------------------------------------------------------------

-- Turn off echo.
\set QUIET 1

-- Format the output nicely.
\pset format unaligned
\pset tuples_only true
\pset pager

-- Revert all changes on failure.
\set ON_ERROR_ROLLBACK 1
\set ON_ERROR_STOP true


BEGIN;

CREATE EXTENSION postgis;

\i sql/01-create_buildings_schema.sql
\i sql/02-create_buildings_stage_schema.sql
\i sql/03-insert_lookup_table_values.sql
\i sql/04-create_buildings_functions.sql
\i sql/05-buildings_version.sql
\i sql/lds/01-create_buildings_lds_schema.sql

CREATE EXTENSION pgtap;

SELECT plan(2);

-- Tests
SELECT has_schema('buildings_lds');
SELECT has_table('buildings_lds', 'nz_building_outlines', 'Should have NZ Building Outlines table in the buildings_lds schema.');

-- Finish pgTAP testing
SELECT * FROM finish();

ROLLBACK;
